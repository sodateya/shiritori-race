<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã—ã‚Šã¨ã‚Šãƒ¬ãƒ¼ã‚¹ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }

        .title {
            font-size: 2.5em;
            color: #4a5568;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .current-word {
            font-size: 3em;
            color: #e53e3e;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(45deg, #fed7d7, #feb2b2);
            border-radius: 15px;
            border: 3px solid #e53e3e;
        }

        .difficulty-selector {
            margin: 30px 0;
        }

        .difficulty-btn {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 0 10px;
            border-radius: 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .difficulty-btn:hover {
            transform: scale(1.05);
        }

        .word-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .word-option {
            background: linear-gradient(45deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .word-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .word-option.correct {
            background: linear-gradient(45deg, #48bb78, #38a169);
            animation: correctPulse 0.5s;
        }

        .word-option.wrong {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            animation: wrongShake 0.5s;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            font-size: 1.5em;
            font-weight: bold;
        }

        .timer {
            color: #e53e3e;
        }

        .progress {
            color: #4299e1;
        }

        .start-btn, .restart-btn {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 25px;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 20px;
        }

        .start-btn:hover, .restart-btn:hover {
            transform: scale(1.05);
        }

        .result {
            font-size: 2em;
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
        }

        .result.success {
            background: linear-gradient(45deg, #c6f6d5, #9ae6b4);
            color: #22543d;
        }

        .result.failure {
            background: linear-gradient(45deg, #fed7d7, #feb2b2);
            color: #742a2a;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="title">ğŸƒâ€â™‚ï¸ ã—ã‚Šã¨ã‚Šãƒ¬ãƒ¼ã‚¹ ğŸƒâ€â™€ï¸</h1>
        
        <div id="start-screen">
            <p style="font-size: 1.3em; margin: 30px 0;">10å›ã®ã—ã‚Šã¨ã‚Šã‚’æœ€é€Ÿã§ã‚¯ãƒªã‚¢ã—ã‚ˆã†ï¼</p>
            <div class="difficulty-selector">
                <button class="difficulty-btn" onclick="setDifficulty('easy')">ã‹ã‚“ãŸã‚“ (4å€‹ã‹ã‚‰é¸æŠ)</button>
                <button class="difficulty-btn" onclick="setDifficulty('normal')">ãµã¤ã† (6å€‹ã‹ã‚‰é¸æŠ)</button>
                <button class="difficulty-btn" onclick="setDifficulty('hard')">ã‚€ãšã‹ã—ã„ (8å€‹ã‹ã‚‰é¸æŠ)</button>
            </div>
        </div>

        <div id="game-screen" class="hidden">
            <div class="game-info">
                <div class="progress">å•é¡Œ: <span id="current-round">1</span>/10</div>
                <div class="timer">æ™‚é–“: <span id="timer">0.0</span>ç§’</div>
            </div>
            
            <div class="current-word" id="current-word">ã‚Šã‚“ã”</div>
            <p style="font-size: 1.2em; margin: 10px 0;">ã€Œ<span id="target-char">ã”</span>ã€ã§å§‹ã¾ã‚‹è¨€è‘‰ã‚’é¸ã‚“ã§ãã ã•ã„ï¼</p>
            
            <div class="word-grid" id="word-grid"></div>
        </div>

        <div id="result-screen" class="hidden">
            <div class="result" id="final-result"></div>
            <button class="restart-btn" onclick="resetGame()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ç”¨ã®å˜èªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        const wordDatabase = {
            'ã‚': ['ã‚ã‚Š', 'ã‚ã‚', 'ã‚ã•', 'ã‚ã', 'ã‚ãŠ', 'ã‚ã¶ã‚‰', 'ã‚ã‹ã‚Š', 'ã‚ã²ã‚‹'],
            'ã„': ['ã„ã¬', 'ã„ãˆ', 'ã„ã‚', 'ã„ã—', 'ã„ã‚‚', 'ã„ã¡ã”', 'ã„ãã‚‚ã®', 'ã„ã®ã¡'],
            'ã†': ['ã†ã¾', 'ã†ã¿', 'ã†ãŸ', 'ã†ã—', 'ã†ã©ã‚“', 'ã†ã•ã', 'ã†ã¡ã‚…ã†', 'ã†ã‚“ã©ã†'],
            'ãˆ': ['ãˆã³', 'ãˆã', 'ãˆã‚“', 'ãˆãŒ', 'ãˆã»ã‚“', 'ãˆã®ã', 'ãˆã„ãŒ', 'ãˆã„ã”'],
            'ãŠ': ['ãŠã«', 'ãŠã¨', 'ãŠã‹ã—', 'ãŠã¯ãª', 'ãŠã†ã¡', 'ãŠã‹ã­', 'ãŠã‚“ãŒã', 'ãŠã„ã—ã„'],
            'ã‹': ['ã‹ã«', 'ã‹ã•', 'ã‹ãœ', 'ã‹ãŠ', 'ã‹ã¿', 'ã‹ã°ã‚“', 'ã‹ãŒã', 'ã‹ã‚“ã˜'],
            'ã': ['ãã¤ã­', 'ãã®ã“', 'ãã‚“ãã‚‡', 'ãã„ã‚', 'ãã£ã¦', 'ãã‚‚ã¡', 'ãã‹ã„', 'ãã‚“ã˜ã‚‡'],
            'ã': ['ãã¾', 'ãã¤', 'ãã‚‹ã¾', 'ãã‚‚', 'ãã ã‚‚ã®', 'ãã†ã', 'ãã˜ã‚‰', 'ãã‚‰ã™'],
            'ã‘': ['ã‘ã‚€ã—', 'ã‘ã—ã', 'ã‘ã‚“', 'ã‘ã„ã', 'ã‘ã—ã‚´ãƒ ', 'ã‘ã‚“ã“ã†', 'ã‘ã„ã•ã‚“', 'ã‘ã£ã“ã‚“'],
            'ã“': ['ã”ã‚Šã‚‰', 'ã”ã¯ã‚“', 'ã”ã¿', 'ã“ãŠã‚Š', 'ã“ã©ã‚‚', 'ã“ã“ã‚', 'ã“ã†ãˆã‚“', 'ã“ãã”'],
            'ã•': ['ã•ã‹ãª', 'ã•ãã‚‰', 'ã•ã‚‹', 'ã•ã¨ã†', 'ã•ã‚“ã½', 'ã•ã„ãµ', 'ã•ã£ã‹ãƒ¼', 'ã•ã„ã”'],
            'ã—': ['ã—ã‹', 'ã—ãŠ', 'ã—ã‚“ã¶ã‚“', 'ã—ã”ã¨', 'ã—ã‚', 'ã—ã‚ã‚ã›', 'ã—ã‚“ã›ã¤', 'ã—ãœã‚“'],
            'ã™': ['ã™ã„ã‹', 'ã™ã—', 'ã™ãšã‚', 'ã™ã¹ã‚Šã ã„', 'ã™ã†ã˜', 'ã™ã¦ã', 'ã™ã„ã¿ã‚“', 'ã™ã°ã‚‰ã—ã„'],
            'ã›': ['ã›ã¿', 'ã›ã‚“ã›ã„', 'ã›ã‹ã„', 'ã›ã¤ã‚ã„', 'ã›ã„ã‹ã¤', 'ã›ã‚“ãŸã', 'ã›ã„ã¨', 'ã›ã„ã˜'],
            'ã': ['ãã‚‰', 'ãã°', 'ãã†ã˜', 'ããµã¨', 'ãã¤ãã‚‡ã†', 'ãã‚“ã–ã„', 'ããã©', 'ãã†ã ã‚“'],
            'ãŸ': ['ãŸã“', 'ãŸã¾ã”', 'ãŸã„ã‚ˆã†', 'ãŸã¹ã‚‚ã®', 'ãŸã‹ã‚‰ã‚‚ã®', 'ãŸã‚“ã˜ã‚‡ã†ã³', 'ãŸã„ã›ã¤', 'ãŸã„ã‘ã‚“'],
            'ã¡': ['ã¡ã‚‡ã†', 'ã¡ãš', 'ã¡ã„ã•ã„', 'ã¡ã‹ã‚‰', 'ã¡ãã‚…ã†', 'ã¡ã‚…ã†ã„', 'ã¡ã‚ƒã‚ã‚“', 'ã¡ã—ã'],
            'ã¤': ['ã¤ã', 'ã¤ããˆ', 'ã¤ã°ã‚', 'ã¤ã‚ˆã„', 'ã¤ã¿ã', 'ã¤ã†ãŒã', 'ã¤ãªãŒã‚Š', 'ã¤ã¥ã'],
            'ã¦': ['ã¦ã‚“ã—', 'ã¦ãŒã¿', 'ã¦ã‚“ã', 'ã¦ã¤ã ã„', 'ã¦ã‚Œã³', 'ã¦ã‚“ã—ã‚‡ã', 'ã¦ã‚“ã‚‰ã‚“', 'ã¦ãã¨ã†'],
            'ã¨': ['ã¨ã‚Š', 'ã¨ã‘ã„', 'ã¨ã‚‚ã ã¡', 'ã¨ã†ãµ', 'ã¨ã‚“ã¼', 'ã¨ã†ãã‚‡ã†', 'ã¨ãã¹ã¤', 'ã¨ã¡ã‚…ã†'],
            'ãª': ['ãªã¤', 'ãªã¾ãˆ', 'ãªã—', 'ãªã¿', 'ãªã‚“ã§ã‚‚', 'ãªã‹ã‚ˆã—', 'ãªãŒã„', 'ãªã‚“ãã‚‡ã'],
            'ã«': ['ã«ã˜', 'ã«ã', 'ã«ã‚“ã˜ã‚“', 'ã«ã‚', 'ã«ã»ã‚“', 'ã«ã‚“ã', 'ã«ã‚…ã†ãŒã', 'ã«ã£ã'],
            'ã¬': ['ã¬ã„ãã‚‹ã¿', 'ã¬ã®', 'ã¬ã‚Šãˆ', 'ã¬ã‚‹ã„', 'ã¬ã‹ã¿ã', 'ã¬ã¾', 'ã¬ã‘', 'ã¬ã„ã‚‚ã®'],
            'ã­': ['ã­ã“', 'ã­ãšã¿', 'ã­ã‚€ã„', 'ã­ã‚“ã‚Œã„', 'ã­ãŒã„', 'ã­ã£ã—ã‚“', 'ã­ã', 'ã­ã‚“ã©'],
            'ã®': ['ã®ãã¿', 'ã®ã©', 'ã®ã†ã‹', 'ã®ãƒ¼ã¨', 'ã®ã‚Šã‚‚ã®', 'ã®ããªã¿', 'ã®ã†ã‚Šã‚‡ã', 'ã®ã‚“ã'],
            'ã¯': ['ã¯ãª', 'ã¯ã¨', 'ã¯ã—', 'ã¯ã˜ã‚', 'ã¯ãŸã‚‰ã', 'ã¯ã‚„ã„', 'ã¯ã‚“ã¶ã‚“', 'ã¯ã£ã´ã‚‡ã†'],
            'ã²': ['ã²ã¤ã˜', 'ã²ã‹ã‚Š', 'ã²ã¨', 'ã²ã‚‹', 'ã²ã¿ã¤', 'ã²ãªãŸ', 'ã²ã¨ã‚Š', 'ã²ãã ã—'],
            'ãµ': ['ãµã­', 'ãµã‚†', 'ãµã†ã›ã‚“', 'ãµã¨ã‚“', 'ãµã—ã', 'ãµãã—ã‚…ã†', 'ãµã‚‹ã•ã¨', 'ãµãã–ã¤'],
            'ã¸': ['ã¸ã³', 'ã¸ã‚„', 'ã¸ã„ã‚', 'ã¸ã‚“ã˜', 'ã¸ã', 'ã¸ã„ã', 'ã¸ã‚“ã‹', 'ã¸ã‚“ã—ã‚“'],
            'ã»': ['ã»ã—', 'ã»ã‚“', 'ã»ã†ã', 'ã»ã‚“ã¨ã†', 'ã»ã‘ã‚“', 'ã»ã†ã»ã†', 'ã»ã£ã¨', 'ã»ã‚“ã'],
            'ã¾': ['ã¾ã‚‹', 'ã¾ã©', 'ã¾ã¤ã‚Š', 'ã¾ã‚', 'ã¾ã„ã«ã¡', 'ã¾ã»ã†', 'ã¾ã‚“ãŒ', 'ã¾ã˜ã‚'],
            'ã¿': ['ã¿ãš', 'ã¿ã‹ã‚“', 'ã¿ã¡', 'ã¿ã©ã‚Š', 'ã¿ã‚“ãª', 'ã¿ã‚‰ã„', 'ã¿ã›', 'ã¿ã˜ã‹ã„'],
            'ã‚€': ['ã‚€ã—', 'ã‚€ã', 'ã‚€ã‚‰', 'ã‚€ãšã‹ã—ã„', 'ã‚€ã‹ã—', 'ã‚€ã‚Šã‚‡ã†', 'ã‚€ã™ã“', 'ã‚€ã '],
            'ã‚': ['ã‚ã ã‹', 'ã‚ãŒã­', 'ã‚ã‚“', 'ã‚ã„ã˜ã‚“', 'ã‚ã‚“ã©ã†', 'ã‚ã„ã‚Œã„', 'ã‚ãšã‚‰ã—ã„', 'ã‚ã‚“ã›ã¤'],
            'ã‚‚': ['ã‚‚ã‚‚', 'ã‚‚ã‚Š', 'ã‚‚ã®', 'ã‚‚ã‚“ã ã„', 'ã‚‚ãã²ã‚‡ã†', 'ã‚‚ã¡ã‚ã‚“', 'ã‚‚ã£ã¨', 'ã‚‚ã†ãµ'],
            'ã‚„': ['ã‚„ã¾', 'ã‚„ã•ã„', 'ã‚„ããã', 'ã‚„ã™ã¿', 'ã‚„ã‚Š', 'ã‚„ã•ã—ã„', 'ã‚„ã‹ã‚“', 'ã‚„ã­ã†ã‚‰'],
            'ã‚†': ['ã‚†ã', 'ã‚†ã‚', 'ã‚†ã³ã‚', 'ã‚†ã†ã', 'ã‚†ã£ãã‚Š', 'ã‚†ã†ã‚ã„', 'ã‚†ã†ã˜ã‚“', 'ã‚†ãŸã‹'],
            'ã‚ˆ': ['ã‚ˆã‚‹', 'ã‚ˆã‚ã“ã³', 'ã‚ˆã¦ã„', 'ã‚ˆã“', 'ã‚ˆã¿ã‚‚ã®', 'ã‚ˆã', 'ã‚ˆã‚ã—ã„', 'ã‚ˆã¼ã†'],
            'ã‚‰': ['ã‚‰ã„ãŠã‚“', 'ã‚‰ãã ', 'ã‚‰ã‚“ã©ã›ã‚‹', 'ã‚‰ã‚“ã¡', 'ã‚‰ã„ã­ã‚“', 'ã‚‰ã„ã’ã¤', 'ã‚‰ãã¦ã‚“', 'ã‚‰ãã”'],
            'ã‚Š': ['ã‚Šã‚“ã”', 'ã‚Šã™', 'ã‚Šã‚‡ã†ã‚Š', 'ã‚Šã‚‡ã“ã†', 'ã‚Šã‹ã„', 'ã‚Šã‚Œã', 'ã‚Šã‚“ã—ã‚‡ã†', 'ã‚Šãã†'],
            'ã‚‹': ['ã‚‹ãƒ¼ã‚‹', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã„ã˜', 'ã‚‹ã™', 'ã‚‹ãƒ¼ã¨', 'ã‚‹ã„ã›ã', 'ã‚‹ã“ã†', 'ã‚‹ã„ã”'],
            'ã‚Œ': ['ã‚Œã„ãã†ã“', 'ã‚Œã‚“ã—ã‚…ã†', 'ã‚Œãã—', 'ã‚Œã‚“ã‚‰ã', 'ã‚Œã‚“ã‚ã„', 'ã‚Œã„ã', 'ã‚Œã‚“ãã', 'ã‚Œã‚“ã”ã†'],
            'ã‚': ['ã‚ã†ãã', 'ã‚ãƒ¼ã‚‰ãƒ¼', 'ã‚ã£ã‹ãƒ¼', 'ã‚ã‚“ã‚Š', 'ã‚ã˜ã£ã', 'ã‚ãƒ¼ã·', 'ã‚ã†ã˜ã‚“', 'ã‚ããŒ'],
            'ã‚': ['ã‚ã«', 'ã‚ã‹ã‚', 'ã‚ã‚‰ã†', 'ã‚ãŸã—', 'ã‚ã™ã‚Œã‚‹', 'ã‚ã ã„', 'ã‚ã‹ã‚‹', 'ã‚ã‚Šã‚ã„'],
            'ã‚’': ['ã‚’ã¨ã‚', 'ã‚’ãŒã‚', 'ã‚’ã‹ã—', 'ã‚’ã¤ã‹', 'ã‚’ã—ãŸ', 'ã‚’ã‚Šã‚‹', 'ã‚’ã‚ã‚Š', 'ã‚’ã¿ã‚‹'],
            'ã‚“': ['ã‚“ã', 'ã‚“ã°', 'ã‚“ã˜', 'ã‚“ã‹', 'ã‚“ã©', 'ã‚“ã±', 'ã‚“ã—ã‚‡', 'ã‚“ã‚Šã‚‡ã']
        };

        // ã²ã‚‰ãŒãªãƒãƒƒãƒ”ãƒ³ã‚°
        const hiraganaMap = {
            'ã‚¢': 'ã‚', 'ã‚¤': 'ã„', 'ã‚¦': 'ã†', 'ã‚¨': 'ãˆ', 'ã‚ª': 'ãŠ',
            'ã‚«': 'ã‹', 'ã‚­': 'ã', 'ã‚¯': 'ã', 'ã‚±': 'ã‘', 'ã‚³': 'ã“',
            'ã‚¬': 'ãŒ', 'ã‚®': 'ã', 'ã‚°': 'ã', 'ã‚²': 'ã’', 'ã‚´': 'ã”',
            'ã‚µ': 'ã•', 'ã‚·': 'ã—', 'ã‚¹': 'ã™', 'ã‚»': 'ã›', 'ã‚½': 'ã',
            'ã‚¶': 'ã–', 'ã‚¸': 'ã˜', 'ã‚º': 'ãš', 'ã‚¼': 'ãœ', 'ã‚¾': 'ã',
            'ã‚¿': 'ãŸ', 'ãƒ': 'ã¡', 'ãƒ„': 'ã¤', 'ãƒ†': 'ã¦', 'ãƒˆ': 'ã¨',
            'ãƒ€': 'ã ', 'ãƒ‚': 'ã¢', 'ãƒ…': 'ã¥', 'ãƒ‡': 'ã§', 'ãƒ‰': 'ã©',
            'ãƒŠ': 'ãª', 'ãƒ‹': 'ã«', 'ãƒŒ': 'ã¬', 'ãƒ': 'ã­', 'ãƒ': 'ã®',
            'ãƒ': 'ã¯', 'ãƒ’': 'ã²', 'ãƒ•': 'ãµ', 'ãƒ˜': 'ã¸', 'ãƒ›': 'ã»',
            'ãƒ': 'ã°', 'ãƒ“': 'ã³', 'ãƒ–': 'ã¶', 'ãƒ™': 'ã¹', 'ãƒœ': 'ã¼',
            'ãƒ‘': 'ã±', 'ãƒ”': 'ã´', 'ãƒ—': 'ã·', 'ãƒš': 'ãº', 'ãƒ': 'ã½',
            'ãƒ': 'ã¾', 'ãƒŸ': 'ã¿', 'ãƒ ': 'ã‚€', 'ãƒ¡': 'ã‚', 'ãƒ¢': 'ã‚‚',
            'ãƒ¤': 'ã‚„', 'ãƒ¦': 'ã‚†', 'ãƒ¨': 'ã‚ˆ',
            'ãƒ©': 'ã‚‰', 'ãƒª': 'ã‚Š', 'ãƒ«': 'ã‚‹', 'ãƒ¬': 'ã‚Œ', 'ãƒ­': 'ã‚',
            'ãƒ¯': 'ã‚', 'ãƒ²': 'ã‚’', 'ãƒ³': 'ã‚“'
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            difficulty: 'normal',
            currentRound: 1,
            totalRounds: 10,
            startTime: null,
            currentWord: '',
            targetChar: '',
            correctAnswer: '',
            wordCount: { easy: 4, normal: 6, hard: 8 }
        };

        // é›£æ˜“åº¦è¨­å®š
        function setDifficulty(difficulty) {
            gameState.difficulty = difficulty;
            startGame();
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            
            gameState.currentRound = 1;
            gameState.startTime = Date.now();
            
            generateInitialWord();
            updateTimer();
        }

        // åˆæœŸå˜èªç”Ÿæˆ
        function generateInitialWord() {
            const words = ['ã‚Šã‚“ã”', 'ã•ãã‚‰', 'ã†ã¿', 'ã‚„ã¾', 'ã²ã‹ã‚Š', 'ã¤ã', 'ã»ã—', 'ã‹ãœ'];
            gameState.currentWord = words[Math.floor(Math.random() * words.length)];
            generateNextRound();
        }

        // æ¿ç‚¹ãƒ»åŠæ¿ç‚¹å‡¦ç†ãƒãƒƒãƒ—
        const dakutenMap = {
            'ãŒ': 'ã‹', 'ã': 'ã', 'ã': 'ã', 'ã’': 'ã‘', 'ã”': 'ã“',
            'ã–': 'ã•', 'ã˜': 'ã—', 'ãš': 'ã™', 'ãœ': 'ã›', 'ã': 'ã',
            'ã ': 'ãŸ', 'ã¢': 'ã¡', 'ã¥': 'ã¤', 'ã§': 'ã¦', 'ã©': 'ã¨',
            'ã°': 'ã¯', 'ã³': 'ã²', 'ã¶': 'ãµ', 'ã¹': 'ã¸', 'ã¼': 'ã»',
            'ã±': 'ã¯', 'ã´': 'ã²', 'ã·': 'ãµ', 'ãº': 'ã¸', 'ã½': 'ã»'
        };

        // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ç”Ÿæˆ
        function generateNextRound() {
            const lastChar = gameState.currentWord.slice(-1);
            gameState.targetChar = lastChar;
            
            // ã²ã‚‰ãŒãªã«å¤‰æ›
            let hiraganaChar = hiraganaMap[lastChar] || lastChar;
            
            // æ¿ç‚¹ãƒ»åŠæ¿ç‚¹ãŒã‚ã‚‹å ´åˆã®å‡¦ç†
            const possibleChars = [hiraganaChar];
            if (dakutenMap[hiraganaChar]) {
                // æ¿ç‚¹ã‚’å¤–ã—ãŸæ–‡å­—ã‚‚è¿½åŠ 
                possibleChars.push(dakutenMap[hiraganaChar]);
            }
            
            // é€†æ–¹å‘ã®æ¤œç´¢ï¼ˆæ¸…éŸ³ã‹ã‚‰æ¿éŸ³ãƒ»åŠæ¿éŸ³ã‚’æ¢ã™ï¼‰
            Object.keys(dakutenMap).forEach(dakuten => {
                if (dakutenMap[dakuten] === hiraganaChar) {
                    possibleChars.push(dakuten);
                }
            });
            
            // æ­£è§£å€™è£œã‚’å–å¾—ï¼ˆè¤‡æ•°ã®æ–‡å­—ã‹ã‚‰é¸æŠå¯èƒ½ï¼‰
            let allCorrectCandidates = [];
            possibleChars.forEach(char => {
                if (wordDatabase[char]) {
                    allCorrectCandidates.push(...wordDatabase[char]);
                }
            });
            
            // å€™è£œãŒãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            if (allCorrectCandidates.length === 0) {
                allCorrectCandidates = ['ã”ã‚Šã‚‰', 'ã”ã¯ã‚“', 'ã”ã¿'];
            }
            
            gameState.correctAnswer = allCorrectCandidates[Math.floor(Math.random() * allCorrectCandidates.length)];
            
            // é–“é•ã„ã®é¸æŠè‚¢ã‚’ç”Ÿæˆ
            const wrongOptions = generateWrongOptions(possibleChars);
            
            // é¸æŠè‚¢ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            const options = [gameState.correctAnswer, ...wrongOptions];
            shuffleArray(options);
            
            // ç”»é¢æ›´æ–°
            updateGameDisplay(options);
        }

        // é–“é•ã„ã®é¸æŠè‚¢ç”Ÿæˆ
        function generateWrongOptions(targetChars) {
            const wrongOptions = [];
            const allChars = Object.keys(wordDatabase);
            const optionCount = gameState.wordCount[gameState.difficulty] - 1;
            
            while (wrongOptions.length < optionCount) {
                const randomChar = allChars[Math.floor(Math.random() * allChars.length)];
                if (!targetChars.includes(randomChar)) {
                    const words = wordDatabase[randomChar];
                    const randomWord = words[Math.floor(Math.random() * words.length)];
                    if (!wrongOptions.includes(randomWord)) {
                        wrongOptions.push(randomWord);
                    }
                }
            }
            
            return wrongOptions;
        }

        // é…åˆ—ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ã‚²ãƒ¼ãƒ ç”»é¢æ›´æ–°
        function updateGameDisplay(options) {
            document.getElementById('current-word').textContent = gameState.currentWord;
            document.getElementById('target-char').textContent = gameState.targetChar;
            document.getElementById('current-round').textContent = gameState.currentRound;
            
            const wordGrid = document.getElementById('word-grid');
            wordGrid.innerHTML = '';
            
            options.forEach(word => {
                const button = document.createElement('button');
                button.className = 'word-option';
                button.textContent = word;
                button.onclick = () => selectWord(word, button);
                wordGrid.appendChild(button);
            });
        }

        // å˜èªé¸æŠ
        function selectWord(selectedWord, buttonElement) {
            const isCorrect = selectedWord === gameState.correctAnswer;
            
            if (isCorrect) {
                buttonElement.classList.add('correct');
                gameState.currentWord = selectedWord;
                
                setTimeout(() => {
                    if (gameState.currentRound >= gameState.totalRounds) {
                        endGame(true);
                    } else {
                        gameState.currentRound++;
                        generateNextRound();
                    }
                }, 500);
            } else {
                buttonElement.classList.add('wrong');
                setTimeout(() => {
                    buttonElement.classList.remove('wrong');
                }, 500);
            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
        function updateTimer() {
            if (gameState.startTime) {
                const elapsed = (Date.now() - gameState.startTime) / 1000;
                document.getElementById('timer').textContent = elapsed.toFixed(1);
                
                if (document.getElementById('game-screen').classList.contains('hidden')) {
                    return;
                }
                
                requestAnimationFrame(updateTimer);
            }
        }

        // ã‚²ãƒ¼ãƒ çµ‚äº†
        function endGame(success) {
            const totalTime = (Date.now() - gameState.startTime) / 1000;
            
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            const resultElement = document.getElementById('final-result');
            
            if (success) {
                resultElement.className = 'result success';
                resultElement.innerHTML = `
                    ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ ğŸ‰<br>
                    ã‚¯ãƒªã‚¢æ™‚é–“: ${totalTime.toFixed(1)}ç§’<br>
                    é›£æ˜“åº¦: ${getDifficultyText(gameState.difficulty)}
                `;
            } else {
                resultElement.className = 'result failure';
                resultElement.innerHTML = `
                    ğŸ˜” ã‚¿ã‚¤ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ ğŸ˜”<br>
                    ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
                `;
            }
        }

        // é›£æ˜“åº¦ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
        function getDifficultyText(difficulty) {
            const texts = { easy: 'ã‹ã‚“ãŸã‚“', normal: 'ãµã¤ã†', hard: 'ã‚€ãšã‹ã—ã„' };
            return texts[difficulty];
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            
            gameState = {
                difficulty: 'normal',
                currentRound: 1,
                totalRounds: 10,
                startTime: null,
                currentWord: '',
                targetChar: '',
                correctAnswer: '',
                wordCount: { easy: 4, normal: 6, hard: 8 }
            };
        }
    </script>
</body>
</html>